<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <title>Raven</title>
</head>

<body style="background-color: black">
  <p id="m" style="color: white"></p>
  <script>
    var p = document.getElementById("m");
    var url = new URL(window.location.href);
    var token = url.searchParams.get("token");
    var origin = url.searchParams.get("origin");
    if (token) {
      console.log("update token to " + token);
      localStorage.setItem("token", token);
      window.close();
      p.innerText = "token saved, you may close me";
    } else {
      console.log("call Hodor");
      var gate = url.searchParams.get("gate");
      if (gate) {
        var dest = new URL(gate);
        dest.searchParams.set("c", url.href);
        dest.searchParams.set("t", '1');
        dest.searchParams.set("o", origin);
        window.location.assign(dest.href);
      } else {
        p.innerText = "gate not defined";
        console.log("gate not defined");
      }
    }
  </script>
</body>

</html>